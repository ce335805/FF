DIR = /home/lv71172/eckhardtFWF/victory#on VSC
#DIR = /p/project/cjhpc26/jhpc2605/victory#jureca
#DIR = /home/chris/uni/victory

#compiler
#CC = mpif90 #on jureca
CC = mpiifort #on VSC
#CC = mpifort #on chris' laptop

#Flags - ipo takes long
#production flags

FFLAGS = -Ofast -ipo -heap-arrays -xHost -qopenmp -traceback -check bounds -warn all -module MOD

#no OpenMP
#FFLAGS = -Ofast -ipo -g -heap-arrays -xHost -traceback -check bounds -warn all -module MOD

#developement flags
#FFLAGS = -O1 -heap-arrays -qopenmp -xHost -traceback -check bounds -warn all -module MOD
#FFLAGS = -O1 -heap-arrays -xHost -traceback -check bounds -warn all -module MOD

#for debugging
#FFLAGS = -O0 -g -qopenmp -heap-arrays -xHost -traceback -check bounds -warn all -module MOD
#FFLAGS = -O0 -g -xHost -heap-arrays -traceback -check bounds -warn all -module MOD

DBGFLAGS = -traceback -warn all -module MOD -g

#load libraries
LIB = $(DIR)/lib/libdfftpack.a -mkl

OBJ_DIR = OBJ

OBJ_FILES = $(addprefix $(OBJ_DIR)/, global_parameter.o MPI_mod.o parquet_ini.o MATH_mod.o parquet_formfactors.o parquet_util.o parquet_plot.o parquet_chi.o parquet_kernel.o parquet_equation.o parquet_selfenergy.o parquet_phys.o parquet_check.o run_test.o victory.o)
SRC_FILES = global_parameter.f90 MPI_mod.f90 parquet_ini.f90 MATH_mod.f90 parquet_formfactors.f90 parquet_util.f90 parquet_plot.f90 parquet_chi.f90 parquet_kernel.f90 parquet_equation.f90 parquet_selfenergy.f90 parquet_phys.f90 parquet_check.f90 run_test.f90 victory.f90

victory: $(OBJ_FILES)
	$(CC) $(FFLAGS) $(OBJ_FILES) $(LIB) -o victory

#small explanation:
#$< - name of first prerequesite
#$@ - name of target

$(OBJ_DIR)/victory.o: victory.f90 MPI_mod.f90 parquet_ini.f90 parquet_util.f90 parquet_formfactors.f90 parquet_plot.f90 parquet_chi.f90 parquet_kernel.f90 parquet_equation.f90 parquet_selfenergy.f90 parquet_check.f90 run_test.f90
	$(CC) $(FFLAGS)  -c $< -o $@  

$(OBJ_DIR)/run_test.o: run_test.f90 parquet_ini.f90 parquet_chi.f90 parquet_util.f90 parquet_formfactors.f90 parquet_plot.f90 parquet_kernel.f90 parquet_equation.f90 parquet_selfenergy.f90
	$(CC) $(FFLAGS)  -c $< -o $@ 
 
$(OBJ_DIR)/parquet_check.o: parquet_check.f90 parquet_util.f90 parquet_ini.f90
	$(CC) $(FFLAGS)  -c $< -o $@ 

$(OBJ_DIR)/parquet_phys.o: parquet_phys.f90 parquet_ini.f90 parquet_util.f90 parquet_kernel.f90
	$(CC) $(FFLAGS)  -c $< -o $@ 
 
$(OBJ_DIR)/parquet_selfenergy.o: parquet_selfenergy.f90 global_parameter.f90 parquet_ini.f90 parquet_util.f90 parquet_formfactors.f90 parquet_kernel.f90 parquet_equation.f90
	$(CC) $(FFLAGS)  -c $< -o $@  

$(OBJ_DIR)/parquet_equation.o: parquet_equation.f90 parquet_ini.f90 parquet_util.f90 parquet_kernel.f90
	$(CC) $(FFLAGS) -c $< -o $@  

$(OBJ_DIR)/parquet_kernel.o: parquet_kernel.f90 parquet_ini.f90 parquet_util.f90
	$(CC) $(FFLAGS)  -c $< -o $@  

$(OBJ_DIR)/parquet_chi.o: parquet_chi.f90 parquet_util.f90 parquet_formfactors.f90 parquet_ini.f90  global_parameter.f90 MATH_mod.f90
	$(CC) $(FFLAGS)  -c $< -o $@  

$(OBJ_DIR)/parquet_plot.o: parquet_plot.f90 parquet_util.f90 parquet_formfactors.f90 parquet_ini.f90
	$(CC) $(FFLAGS)  -c $< -o $@ 
 
$(OBJ_DIR)/parquet_util.o: parquet_util.f90 parquet_formfactors.f90 parquet_ini.f90  global_parameter.f90
	$(CC) $(FFLAGS)  -c $< -o $@  

$(OBJ_DIR)/parquet_formfactors.o: parquet_formfactors.f90 parquet_ini.f90
	$(CC) $(FFLAGS)  -c $< -o $@

$(OBJ_DIR)/MATH_mod.o: MATH_mod.f90 parquet_ini.f90 global_parameter.f90
	$(CC) $(FFLAGS)  -c $< -o $@
	
$(OBJ_DIR)/parquet_ini.o: parquet_ini.f90
	$(CC) $(FFLAGS)  -c $< -o $@
	
$(OBJ_DIR)/MPI_mod.o: MPI_mod.f90 global_parameter.f90
	$(CC) $(FFLAGS)  -c $< -o $@

$(OBJ_DIR)/global_parameter.o: global_parameter.f90
	$(CC) $(FFLAGS)  -c $< -o $@ 



#other rules
debug: $(SRC_FILES)
	$(CC) $(DBGFLAGS) $(SRC_FILES) $(LIB)  -o victory

clean: 
	-rm $(OBJ_FILES) MOD/*.mod data/*.dat victory
